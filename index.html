<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Marble Ludo</title>
<style>
body{
 font-family:Arial;
 background:#f2f2f2;
 display:flex;
 justify-content:center;
}
#game{
 position:relative;
 width:520px;
}
canvas{
 background:white;
 border:2px solid black;
 margin:60px auto;
 display:block;
}
button{
 position:absolute;
 top:0; left:50%;
 transform:translateX(-50%);
 padding:8px 16px;
 font-size:16px;
}
.playerBox{
 position:absolute;
 width:120px;
 padding:6px;
 border:2px solid #999;
 background:#fff;
 font-size:14px;
 text-align:center;
}
.active{border-color:black;font-weight:bold}
.marble{
 width:18px;height:18px;border-radius:50%;
 display:inline-block;margin:2px;border:1px solid #333;
}
.white{background:#f5f5f5}
.black{background:#222}
#info{text-align:center;font-weight:bold;margin-top:6px}
</style>
</head>
<body>

<div id="game">
<button onclick="playTurn()">Draw Marbles</button>
<div id="info"></div>

<!-- Player boxes -->
<div id="p0" class="playerBox" style="bottom:0;left:200px;color:blue">P1<br>Blue<div class="marbles"></div></div>
<div id="p1" class="playerBox" style="right:0;top:200px;color:green">P2<br>Green<div class="marbles"></div></div>
<div id="p2" class="playerBox" style="top:0;left:200px;color:purple">P3<br>Purple<div class="marbles"></div></div>
<div id="p3" class="playerBox" style="left:0;top:200px;color:orange">P4<br>Orange<div class="marbles"></div></div>

<canvas id="board" width="400" height="400"></canvas>
</div>

<script>
const GRID=5,CELL=80,STEP_DELAY=250;
const board=[[0,0,1,0,0],[0,0,0,0,0],[1,0,2,0,1],[0,0,0,0,0],[0,0,1,0,0]];
const outerPath=[
 {x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0},{x:4,y:0},
 {x:4,y:1},{x:4,y:2},{x:4,y:3},{x:4,y:4},
 {x:3,y:4},{x:2,y:4},{x:1,y:4},{x:0,y:4},
 {x:0,y:3},{x:0,y:2},{x:0,y:1}
];
const innerPath=[{x:2,y:3},{x:3,y:2},{x:2,y:1},{x:1,y:2}];
const FINISH={x:2,y:2};

const players=[
 {name:"P1",color:"blue",start:{x:2,y:4},tokens:[]},
 {name:"P2",color:"green",start:{x:4,y:2},tokens:[]},
 {name:"P3",color:"purple",start:{x:2,y:0},tokens:[]},
 {name:"P4",color:"orange",start:{x:0,y:2},tokens:[]}
];

players.forEach(p=>{
 const idx=outerPath.findIndex(q=>q.x===p.start.x&&q.y===p.start.y);
 for(let i=0;i<4;i++)p.tokens.push({mode:"outer",outerIndex:idx,innerIndex:0,finished:false});
});

let currentPlayer=0,selectedToken=0,animating=false;
const canvas=document.getElementById("board");
const ctx=canvas.getContext("2d");
const info=document.getElementById("info");

function drawBoard(){
 ctx.clearRect(0,0,400,400);
 for(let y=0;y<GRID;y++)for(let x=0;x<GRID;x++){
  ctx.fillStyle=board[y][x]==1?"#f4a261":board[y][x]==2?"#90dbf4":"#fff";
  ctx.fillRect(x*CELL,y*CELL,CELL,CELL);
  ctx.strokeRect(x*CELL,y*CELL,CELL,CELL);
 }
 players.forEach((p,pi)=>{
  p.tokens.forEach((t,i)=>{
   if(t.finished)return;
   let pos=t.mode==="outer"?outerPath[t.outerIndex]:t.mode==="inner"?innerPath[t.innerIndex]:FINISH;
   ctx.beginPath();
   ctx.fillStyle=p.color;
   ctx.arc(pos.x*CELL+CELL/2+(i%2)*6,pos.y*CELL+CELL/2+Math.floor(i/2)*6,11,0,Math.PI*2);
   ctx.fill();
  });
 });
 document.querySelectorAll(".playerBox").forEach((b,i)=>b.classList.toggle("active",i===currentPlayer));
}

function drawMarbles(){
 document.querySelectorAll(".marbles").forEach(m=>m.innerHTML="");
 let box=document.querySelector(`#p${currentPlayer} .marbles`);
 let whites=0;
 for(let i=0;i<4;i++){
  let w=Math.random()<0.5;
  whites+=w?1:0;
  let d=document.createElement("div");
  d.className="marble "+(w?"white":"black");
  box.appendChild(d);
 }
 let steps=[8,3,2,1,4][whites];
 info.innerText=`${players[currentPlayer].name} â†’ ${steps} steps`;
 return steps;
}

function moveOneStep(t){
 if(t.mode==="outer"){
  t.outerIndex=(t.outerIndex+1)%outerPath.length;
  let p=outerPath[t.outerIndex];
  if(board[p.y][p.x]===1&&p.x===2&&p.y!==2){t.mode="inner";t.innerIndex=0;}
 }else if(t.mode==="inner"){
  t.innerIndex++;
  if(t.innerIndex===innerPath.length)t.finished=true;
 }
}

function animateMove(steps,cb){
 let t=players[currentPlayer].tokens[selectedToken];
 if(steps<=0||t.finished){cb();return;}
 animating=true;
 moveOneStep(t);drawBoard();
 setTimeout(()=>animateMove(steps-1,cb),STEP_DELAY);
}

function playTurn(){
 if(animating)return;
 let steps=drawMarbles();
 animateMove(steps,()=>{
  animating=false;
  currentPlayer=(currentPlayer+1)%4;
 });
}

drawBoard();
</script>
</body>
</html>
